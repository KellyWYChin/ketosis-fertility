df.305dmilk <- df.first305d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
df.305dmilk <- df.first305d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
df.first305d.comp <- subset(df.first305d, MinDFC == "4" & MaxDFC == "305")
df.first305d.comp <- subset(df.first305d, MinDFC == "4" & MaxDFC == "305")
df.305d_ind <- df.first305d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
df.305dmilk <- df.first305d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
df.first305d.comp <- subset(df.first305d, MinDFC == "4" & MaxDFC == "305")
df.305d_ind <- df.first305d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
# complete time period measurements
df.master4 <- merge(df.master3, df.305d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE)
# less strict on the complete days
df.master8 <-merge(df.master6, df.305dmilk,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
milk <- merge(df.lact, df.master4,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
# complete time period measurements
df.master4 <- merge(df.master3, df.305d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE)
# less strict on the complete days
df.master8 <-merge(df.master6, df.305dmilk,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
milk <- merge(df.lact, df.master4,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
milk <- milk[!is.na(milk$FarmNo), ]
milk_all <- merge(df.lact, df.master8,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE)
milk_all <- milk_all[!is.na(milk_all$FarmNo), ]
milk_all <- milk_all[!is.na(milk_all$CalvingDate), ]
rm(list=ls(pattern="df"))
rm(all_milk)
View(milk)
df.lact <- all_farm %>%
select(CowId, FarmNo, CalvingDate, Lactation, PeakYield, PeakDim) %>%
distinct(CowId, FarmNo, Lactation, CalvingDate, .keep_all=TRUE)
all_milk_raw <- data.frame()
for (i in 1001:1038) {
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.milk <- read_excel(filename, sheet = "MilkData")
df.cowinfo <- read_excel(filename, sheet = "CowInfo")
# change the column name of cowinfo (CowID -> CowId)
colnames(df.cowinfo)[colnames(df.cowinfo)=="CowID"] <- "CowId"
df.cowinfo$BirthDate <- as.character(df.cowinfo$BirthDate)
df.milkfarm <- merge(df.cowinfo, df.milk, by = "CowId", all.x= TRUE, all.y=TRUE) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
all_milk_raw <- bind_rows(all_milk_raw, df.milkfarm)
}
all_milk_raw
all_milk_raw$CowNo <- NULL
all_milk_raw$BirthDate <- NULL
all_milk_raw$Inclusion <- NULL
all_milk_raw$HasMilkLactCowID <- NULL
all_milk <- all_milk_raw %>%
distinct(FarmNo, CowId)
#create a milk dataframe including all milk information from 38 farms #
df.merge <- data.frame()
df.merge <- merge(df.lact, all_milk_raw, by=c('FarmNo', 'CowId'), all.x=TRUE, all.y=TRUE) %>%
group_by(FarmNo, CowId, CalvingDate) %>%
arrange(DFC, .by_group=TRUE)
summary(df.merge)
# Exclude cows without FarmNo
df.merge <- df.merge[!is.na(df.merge$FarmNo), ]
summary(df.merge)
# Exclude cows without CowId, Calving Date
df.merge$CalvingDate <- as.character(df.merge$CalvingDate)
df.merge <- df.merge[!(is.na(df.merge$CowId) | is.na(df.merge$CalvingDate)), ]
# Exclude DIM 1-3 milk yield
df.merge1 <- df.merge %>%
filter(DFC > 3)
# if daily milk yield <1 kg, we name it as NA; others = original daily milk yield
df.merge1$DayYield <- ifelse(df.merge1$DayYield < 1, NA, df.merge1$DayYield)
df.merge <- df.merge1
# How many cows remain?
df.merge2 <- df.merge1 %>%
distinct(FarmNo, CowId) #5,119 cows
#############################
#   Cumulative milk yield   #
#############################
# Cumulative milk yield, mean milk yield
cumulativeMY <- function(D){
df.merge %>%
group_by(FarmNo, CowId, CalvingDate) %>%
select(Lactation, DayYield, DFC) %>%
filter(DFC <= D) %>%
mutate(!!paste0('AvgMY', D) := mean(DayYield),
MinDFC = min(DFC),
MaxDFC = max(DFC),
!!paste0('SumMY', D) := sum(DayYield))
}
# First 20 days
df.first20d <- cumulativeMY(20)
# ONLY when Min DFC = 4 and  Max DFC = 20 the cows can be included into the dataset #
df.first20d.comp <- subset(df.first20d,
MinDFC == "4" & MaxDFC == "20")
# All cows
df.20dmilk <- df.first20d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY20, SumMY20) %>%
distinct(FarmNo, CowId, Lactation, AvgMY20, SumMY20)
# Only the cows have completed 4-20 DIM milk records
df.20d_ind <- df.first20d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY20, SumMY20) %>%
distinct(FarmNo, CowId, Lactation, AvgMY20, SumMY20)
# First 60 days
df.first60d <- cumulativeMY(60)
# Only the cows have completed 4-60 DIM milk records
df.first60d.comp <- subset(df.first60d,
MinDFC == "4" & MaxDFC == "60")
summary(df.first60d.comp)
df.60dmilk <- df.first60d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY60, SumMY60) %>%
distinct(FarmNo, CowId, Lactation, CalvingDate, AvgMY60, SumMY60)
df.60d_ind <- df.first60d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY60, SumMY60) %>%
distinct(FarmNo, CowId, Lactation, AvgMY60, SumMY60)
df.master1 <- merge(df.20d_ind, df.60d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
df.master5 <- merge(df.20dmilk, df.60dmilk,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
# First 80 days
df.first80d <- cumulativeMY(80)
# Only the cows have completed 4-80 DIM milk records
df.first80d.comp <- subset(df.first80d,
MinDFC == "4" & MaxDFC == "80")
df.80dmilk <- df.first80d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY80, SumMY80) %>%
distinct(FarmNo, CowId, Lactation, AvgMY80, SumMY80)
df.80d_ind <- df.first80d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY80, SumMY80) %>%
distinct(FarmNo, CowId, Lactation, AvgMY80, SumMY80)
df.master2 <- merge(df.master1, df.80d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
df.master6 <- merge(df.master5, df.80dmilk,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
View(df.master5)
View(df.20d_ind)
# First 150 days
df.first150d <- cumulativeMY(150)
df.150dmilk <- df.first150d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY150, SumMY150) %>%
distinct(FarmNo, CowId, Lactation, AvgMY150, SumMY150)
df.150d_ind <- df.first150d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY150, SumMY150) %>%
distinct(FarmNo, CowId, Lactation, AvgMY150, SumMY150)
df.first150d.comp <- subset(df.first150d, MinDFC == "4" & MaxDFC == "150")
df.first150d.comp <- subset(df.first150d, MinDFC == "4" & MaxDFC == "150")
df.150dmilk <- df.first150d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY150, SumMY150) %>%
distinct(FarmNo, CowId, Lactation, AvgMY150, SumMY150)
df.150d_ind <- df.first150d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY150, SumMY150) %>%
distinct(FarmNo, CowId, Lactation, AvgMY150, SumMY150)
df.master3 <- merge(df.master2, df.150d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
df.master7 <- merge(df.master6, df.150dmilk,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
# First 305 days
df.first305d <- cumulativeMY(305)
# First 305 days
df.first305d <- cumulativeMY(305)
df.305dmilk <- df.first305d %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
df.first305d.comp <- subset(df.first305d, MinDFC == "4" & MaxDFC == "305")
df.first305d.comp <- subset(df.first305d, MinDFC == "4" & MaxDFC == "305")
df.305d_ind <- df.first305d.comp %>%
select(FarmNo, CowId, Lactation, CalvingDate, AvgMY305, SumMY305) %>%
distinct(FarmNo, CowId, Lactation, AvgMY305, SumMY305)
# complete time period measurements
df.master4 <- merge(df.master3, df.305d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE)
# less strict on the complete days
df.master8 <-merge(df.master6, df.305dmilk,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
# less strict on the complete days
df.master8 <-merge(df.master7, df.305dmilk,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
# complete time period measurements
df.master4 <- merge(df.master3, df.305d_ind,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE)
# less strict on the complete days
df.master8 <-merge(df.master7, df.305dmilk,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
df.lact$CalvingDate <- as.character(df.lact$CalvingDate)
milk <- merge(df.lact, df.master4,
by=c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x=TRUE, all.y=TRUE)
milk <- milk[!is.na(milk$FarmNo), ]
milk_all <- merge(df.lact, df.master8,
by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE)
milk_all <- milk_all[!is.na(milk_all$FarmNo), ]
milk_all <- milk_all[!is.na(milk_all$CalvingDate), ]
rm(list=ls(pattern="df"))
rm(all_milk)
# re-categroize Lactation into 4 groups: 1, 2, 3, and 4+
milk$ad_Lactation[milk$Lactation >= 4] <- 4
milk$ad_Lactation[milk$Lactation == 3] <- 3
milk$ad_Lactation[milk$Lactation == 2] <- 2
milk$ad_Lactation[milk$Lactation == 1] <- 1
milk_all$ad_Lactation[milk_all$Lactation >= 4] <- 4
milk_all$ad_Lactation[milk_all$Lactation == 3] <- 3
milk_all$ad_Lactation[milk_all$Lactation == 2] <- 2
milk_all$ad_Lactation[milk_all$Lactation == 1] <- 1
View(repro)
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
setwd("C:/Users/user/good-enough-project-template")
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/", i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
df.lact <- all_farm %>%
select(CowId, FarmNo, CalvingDate, Lactation, PeakYield, PeakDim) %>%
distinct(CowId, FarmNo, Lactation, CalvingDate, .keep_all=TRUE)
all_milk_raw <- data.frame()
for (i in 1001:1038) {
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.milk <- read_excel(filename, sheet = "MilkData")
df.cowinfo <- read_excel(filename, sheet = "CowInfo")
# change the column name of cowinfo (CowID -> CowId)
colnames(df.cowinfo)[colnames(df.cowinfo)=="CowID"] <- "CowId"
df.cowinfo$BirthDate <- as.character(df.cowinfo$BirthDate)
df.milkfarm <- merge(df.cowinfo, df.milk, by = "CowId", all.x= TRUE, all.y=TRUE) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
all_milk_raw <- bind_rows(all_milk_raw, df.milkfarm)
}
setwd("C:/Users/user/good-enough-project-template")
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
knitr::opts_chunk$set(echo = TRUE)
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
library(readxl)
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(reader)
library(lubridate)
library(docstring)
library(roxygen2)
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
setwd("C:/Users/user/good-enough-project-template")
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
read_excel("../data/raw, 1001 All Data Proc June 2020.xlsx", sep = "")
read_excel("data/raw/1001, All Data, Proc, June 2020.xlsx")
read_excel("../data/raw/1001, All Data, Proc, June 2020.xlsx")
setwd("C:/Users/user/good-enough-project-template")
paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
read_excel("../data/raw/1001, All Data, Proc, June 2020.xlsx")
paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.lact <- all_farm %>%
select(CowId, FarmNo, CalvingDate, Lactation, PeakYield, PeakDim) %>%
distinct(CowId, FarmNo, Lactation, CalvingDate, .keep_all=TRUE)
all_milk_raw <- data.frame()
for (i in 1001:1038) {
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.milk <- read_excel(filename, sheet = "MilkData")
df.cowinfo <- read_excel(filename, sheet = "CowInfo")
# change the column name of cowinfo (CowID -> CowId)
colnames(df.cowinfo)[colnames(df.cowinfo)=="CowID"] <- "CowId"
df.cowinfo$BirthDate <- as.character(df.cowinfo$BirthDate)
df.milkfarm <- merge(df.cowinfo, df.milk, by = "CowId", all.x= TRUE, all.y=TRUE) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
all_milk_raw <- bind_rows(all_milk_raw, df.milkfarm)
}
setwd("C:/Users/user/good-enough-project-template")
#########################
#   Merge Reproduction  #
#########################
# Merge reproduction data from 38 farms
# empty the data frame first
all_farm_raw <- data.frame()
for (i in 1001:1038) {
# create the excel file name base on the input i
filename <- paste("../data/raw/", i,", All Data, Proc, June 2020.xlsx", sep = "")
# load the sheets within the same excel file (the same farm)
df.calving <- read_excel(filename, sheet = "Calving")
df.cowinfo <- read_excel(filename, sheet = "CowInfo")
# change the column name of cowinfo (CowID -> CowId)
colnames(df.cowinfo)[colnames(df.cowinfo)=="CowID"] <- "CowId"
# change the column BirthDate into character
df.cowinfo$BirthDate <- as.character(df.cowinfo$BirthDate)
df.culldata <- read_excel(filename, sheet = "CullData")
df.calving <- read_excel(filename, sheet = "Calving")
df.insemination <- read_excel(filename, sheet = "Insemination")
df.pregnancy <- read_excel(filename, sheet = "Pregnancy")
# merge the data of different sheets within the same farm
df.farm <- merge(df.cowinfo, df.calving, by = "CowId", all.x=TRUE, all.y=TRUE) %>%
merge(df.culldata, by = "CowId", all.x = TRUE, all.y=TRUE) %>%
merge(df.insemination, by = "CowId", all.x=TRUE, all.y=TRUE) %>%
merge(df.pregnancy, by = "CowId", all.x=TRUE, all.y=TRUE)
# append all the merged data into the master final data table
all_farm_raw <- bind_rows(all_farm_raw, df.farm)
}
#########################
#   Merge Reproduction  #
#########################
# Merge reproduction data from 38 farms
# empty the data frame first
all_farm_raw <- data.frame()
for (i in 1001:1038) {
# create the excel file name base on the input i
filename <- paste("../data/raw/", i,", All Data, Proc, June 2020.xlsx", sep = "")
# load the sheets within the same excel file (the same farm)
df.calving <- read_excel(filename, sheet = "Calving")
df.cowinfo <- read_excel(filename, sheet = "CowInfo")
# change the column name of cowinfo (CowID -> CowId)
colnames(df.cowinfo)[colnames(df.cowinfo)=="CowID"] <- "CowId"
# change the column BirthDate into character
df.cowinfo$BirthDate <- as.character(df.cowinfo$BirthDate)
df.culldata <- read_excel(filename, sheet = "CullData")
df.calving <- read_excel(filename, sheet = "Calving")
df.insemination <- read_excel(filename, sheet = "Insemination")
df.pregnancy <- read_excel(filename, sheet = "Pregnancy")
# merge the data of different sheets within the same farm
df.farm <- merge(df.cowinfo, df.calving, by = "CowId", all.x=TRUE, all.y=TRUE) %>%
merge(df.culldata, by = "CowId", all.x = TRUE, all.y=TRUE) %>%
merge(df.insemination, by = "CowId", all.x=TRUE, all.y=TRUE) %>%
merge(df.pregnancy, by = "CowId", all.x=TRUE, all.y=TRUE)
# append all the merged data into the master final data table
all_farm_raw <- bind_rows(all_farm_raw, df.farm)
}
knitr::opts_chunk$set(echo = TRUE)
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
library(readxl)
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(reader)
library(lubridate)
library(docstring)
library(roxygen2)
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
setwd("C:/Users/user/good-enough-project-template")
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("~/data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
all_keto_raw <- data.frame()
for(i in 1001:1038){
filename <- paste("../data/raw/",i,", All Data, Proc, June 2020.xlsx", sep = "")
df.keto <- read_excel(filename, sheet = "Ketosis")
all_keto_raw <- bind_rows(all_keto_raw, df.keto) %>%
group_by(FarmNo, CowId) %>%
arrange(DFC, .by_group = TRUE)
}
library(readxl)
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(reader)
library(lubridate)
library(docstring)
library(roxygen2)
#########################
#   Merge Reproduction  #
#########################
# Merge reproduction data from 38 farms
# empty the data frame first
all_farm_raw <- data.frame()
for (i in 1001:1038) {
# create the excel file name base on the input i
filename <- paste("../data/raw/", i,", All Data, Proc, June 2020.xlsx", sep = "")
# load the sheets within the same excel file (the same farm)
df.calving <- read_excel(filename, sheet = "Calving")
df.cowinfo <- read_excel(filename, sheet = "CowInfo")
# change the column name of cowinfo (CowID -> CowId)
colnames(df.cowinfo)[colnames(df.cowinfo)=="CowID"] <- "CowId"
# change the column BirthDate into character
df.cowinfo$BirthDate <- as.character(df.cowinfo$BirthDate)
df.culldata <- read_excel(filename, sheet = "CullData")
df.calving <- read_excel(filename, sheet = "Calving")
df.insemination <- read_excel(filename, sheet = "Insemination")
df.pregnancy <- read_excel(filename, sheet = "Pregnancy")
# merge the data of different sheets within the same farm
df.farm <- merge(df.cowinfo, df.calving, by = "CowId", all.x=TRUE, all.y=TRUE) %>%
merge(df.culldata, by = "CowId", all.x = TRUE, all.y=TRUE) %>%
merge(df.insemination, by = "CowId", all.x=TRUE, all.y=TRUE) %>%
merge(df.pregnancy, by = "CowId", all.x=TRUE, all.y=TRUE)
# append all the merged data into the master final data table
all_farm_raw <- bind_rows(all_farm_raw, df.farm)
}
