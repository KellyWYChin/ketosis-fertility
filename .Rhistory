ylab("#cows") +
theme_classic()
# DFCFirstHeat
ggplot(data=Three, aes(x=DFCFirstHeat)) +
geom_histogram(breaks=seq(0, 250, by=5),
fill="lightgreen") +
#facet_wrap(Three$FarmNo) +
ggtitle("Days from Calving to First Insemination") +
xlab("DFC") +
ylab("#cows") +
theme_classic()
#DaysToFirstIns
ggplot(data=Three, aes(x=DaysToFirstIns)) +
geom_histogram(breaks=seq(0, 200, by=5),
fill="green") +
#facet_wrap(Three$FarmNo) +
ggtitle("Days from Calving to First Heat") +
xlab("DFC") +
ylab("#cows") +
theme_classic()
ggplot(data=fix2, aes(x=AvgMilk20)) +
geom_histogram(breaks=seq(0, 60, by=3),
col="red", fill="green", alpha=0.2) +
facet_wrap(fix2$ad_Lactation) +
ggtitle("First 20d Average Milk Yield in Different Parities")
### Number of cows in each farm
df.cow <- merge(df.cow, df.cowno, by = c('FarmNo'), sort = F)
df.cow <- df.cow %>%
relocate(CowNo, .after = FarmNo) #4673 obs 65v
#################
#  Descriptive  #
#################
# How many duplicated cows? -> 51 cows
nrow(TWoParity)/2
# Number of cows in this study -> 4673 cows
df.cow <- Three %>%
distinct(FarmNo, CowId, .keep_all=T) #4673 obs of 64v
nrow(df.cow)
# Number of cows in the farm
df.cow$FarmNo <- as.factor(df.cow$FarmNo)
ggplot(data=df.cow, aes(x=fct_rev(fct_infreq(FarmNo)))) +
geom_bar(stat="count", fill="orange") +
stat_count(geom="text", size=3, aes(label=..count..)) +
theme_classic() +
theme(panel.border = element_blank(),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
ggtitle("Number of Cows in Each Farm") +
xlab("Farm ID")
### Add variable CowNo = number of cows in a farm
df.cowno <- data.frame(table(df.cow$FarmNo))
colnames(df.cowno)[colnames(df.cowno) == "Var1"] <- "FarmNo"
colnames(df.cowno)[colnames(df.cowno) == "Freq"] <- "CowNo"
### Number of cows in each farm
df.cow <- merge(df.cow, df.cowno, by = c('FarmNo'), sort = F)
df.cow <- df.cow %>%
relocate(CowNo, .after = FarmNo) #4673 obs 65v
### Number of cows in each farm
df.cow <- merge(df.cow, df.cowno, by = c('FarmNo'), sort = F)
View(df.cow)
#################################
#  Merge ketosis, reproduction  #
#################################
df.two <- merge(reproduction, ketosis,
by = c('FarmNo', 'CowId', 'Lactation'),
all.x = TRUE, all.y = TRUE, sort = F) %>%
#5230 obs of 50 variables
distinct(FarmNo, CowId, Lactation, CalvingDate, .keep_all = T) #5173 obs
summary(df.two)
df.two$CalvingDate <- as.Date(df.two$CalvingDate)
# Check if there are duplicated cows -> 60 duplicated cows
df.two$farmcow <- paste(df.two$FarmNo, df.two$CowId, sep="")
# Select cows with 2 parities
df.two_parity <- df.two %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #120 obs of 52 variables
# Check if reproduction data and ketosis are in the same parity
df.two_parity$MedianSampleTime.x <- as.Date(df.two_parity$MedianSampleTime.x)
df.two_parity <- df.two_parity %>%
select(FarmNo, CowId, Lactation, CalvingDate, MedianSampleTime.x, farmcow.dup) %>%
mutate(sample.calving = difftime(MedianSampleTime.x, CalvingDate, units="days")) # Only 4 cows did not have info for one of the parities -> remove these 4 records
# Farm1002, cow 1813
# Farm1002, cow 1817
# Farm1010, cow 179
# Farm1025, cow 197
df.two_parity <- df.two_parity[-which(df.two_parity$CowId == 1813), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1002& df.two_parity$CowId == 1817), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1010& df.two_parity$CowId == 179), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1025& df.two_parity$CowId == 197), ]
#112 obs 7 variables
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'), all.x = TRUE, all.y = TRUE, sort = F) #5173 obs of 64 variables
summary(df.three)
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
#5169 obs if 64v
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5125 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4868 obs
summary(df.three)
# Exclude cows without DFC_CLA
df.three <- df.three[!is.na(df.three$DFC_CLA), ] #4806 obs
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4744 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4729 obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4724 obs
summary(df.three)
# Select cows with 2 parities
df.three$farmcow <- paste(df.three$FarmNo, df.three$CowId, sep="")
df.three_twoparity <- df.three %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #102 obs
####################
# Ready data frame #
####################
Three <- df.three #4724 obs of 64v
TWoParity <- df.three_twoparity #102 obs of 65v
rm(list = ls(pattern = "df"))
rm(list = ls(pattern = "all_"))
#################################
#  Merge ketosis, reproduction  #
#################################
df.two <- merge(reproduction, ketosis,
by = c('FarmNo', 'CowId', 'Lactation'),
all.x = TRUE, all.y = TRUE, sort = F) %>%
#5230 obs of 50 variables
distinct(FarmNo, CowId, Lactation, CalvingDate, .keep_all = T) #5173 obs
summary(df.two)
df.two$CalvingDate <- as.Date(df.two$CalvingDate)
# Check if there are duplicated cows -> 60 duplicated cows
df.two$farmcow <- paste(df.two$FarmNo, df.two$CowId, sep="")
# Select cows with 2 parities
df.two_parity <- df.two %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #120 obs of 52 variables
# Check if reproduction data and ketosis are in the same parity
df.two_parity$MedianSampleTime.x <- as.Date(df.two_parity$MedianSampleTime.x)
df.two_parity <- df.two_parity %>%
select(FarmNo, CowId, Lactation, CalvingDate, MedianSampleTime.x, farmcow.dup) %>%
mutate(sample.calving = difftime(MedianSampleTime.x, CalvingDate, units="days")) # Only 4 cows did not have info for one of the parities -> remove these 4 records
# Farm1002, cow 1813
# Farm1002, cow 1817
# Farm1010, cow 179
# Farm1025, cow 197
df.two_parity <- df.two_parity[-which(df.two_parity$CowId == 1813), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1002& df.two_parity$CowId == 1817), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1010& df.two_parity$CowId == 179), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1025& df.two_parity$CowId == 197), ]
#112 obs 7 variables
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'), all.x = TRUE, all.y = TRUE, sort = F) #5173 obs of 64 variables
summary(df.three)
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
#5169 obs if 64v
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5125 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4868 obs
summary(df.three)
# Exclude cows without DFC_CLA
df.three <- df.three[!is.na(df.three$DFC_CLA), ] #4806 obs
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4744 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4729 obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4724 obs
summary(df.three)
# Select cows with 2 parities
df.three$farmcow <- paste(df.three$FarmNo, df.three$CowId, sep="")
df.three_twoparity <- df.three %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #102 obs
####################
# Ready data frame #
####################
#Three <- df.three #4724 obs of 64v
#TWoParity <- df.three_twoparity #102 obs of 65v
#rm(list = ls(pattern = "df"))
#rm(list = ls(pattern = "all_"))
View(df.three_twoparity)
View(df.two_parity)
df.test <- df.two_parity %>%
summarise(min(Lactation))
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
summarise(min(Lactation))
View(df.test)
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
filter(min(Lactation))
View(df.test)
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
subset(min(Lactation))
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
select(-max(Lactation))
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
select(-max(df.two_parity$Lactation))
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
identical(min(Lactation))
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
slice_min(Lactation)
View(df.test)
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
top_n(Lactation)
View(df.test)
df.test <- df.two_parity %>%
group_by(FarmNo, CowId, Lactation) %>%
filter(Lactation == min(Lactation))
View(df.test)
df.test <- df.two_parity %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation))
View(df.test)
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE, sort = F) #5173 obs of 64 variables
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three %>%
group_by(FarmNo, CowId) %>%
filter(Lactation = min(Lactation))
df.three <- df.three %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation))
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5125 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4868 obs
summary(df.three)
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4744 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4729 obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4724 obs
summary(df.three)
df.three_twoparity <- df.three %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #102 obs
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE, sort = F) #5173 obs of 64 variables
summary(df.three)
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation)) #5113 pbs 64v
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5125 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4868 obs
# Exclude cows without DFC_CLA
df.three <- df.three[!is.na(df.three$DFC_CLA), ] #4806 obs
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4744 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4729 obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4724 obs
####################
# Ready data frame #
####################
Three <- df.three #4724 obs of 64v
#################################
#  Merge ketosis, reproduction  #
#################################
df.two <- merge(reproduction, ketosis,
by = c('FarmNo', 'CowId', 'Lactation'),
all.x = TRUE, all.y = TRUE, sort = F) %>%
#5230 obs of 50 variables
distinct(FarmNo, CowId, Lactation, CalvingDate, .keep_all = T) #5173 obs
summary(df.two)
df.two$CalvingDate <- as.Date(df.two$CalvingDate)
# Check if there are duplicated cows -> 60 duplicated cows
df.two$farmcow <- paste(df.two$FarmNo, df.two$CowId, sep="")
# Select cows with 2 parities
df.two_parity <- df.two %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #120 obs of 52 variables
# Check if reproduction data and ketosis are in the same parity
df.two_parity$MedianSampleTime.x <- as.Date(df.two_parity$MedianSampleTime.x)
df.two_parity <- df.two_parity %>%
select(FarmNo, CowId, Lactation, CalvingDate, MedianSampleTime.x, farmcow.dup) %>%
mutate(sample.calving = difftime(MedianSampleTime.x, CalvingDate, units="days")) # Only 4 cows did not have info for one of the parities -> remove these 4 records
# Farm1002, cow 1813
# Farm1002, cow 1817
# Farm1010, cow 179
# Farm1025, cow 197
df.two_parity <- df.two_parity[-which(df.two_parity$CowId == 1813), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1002& df.two_parity$CowId == 1817), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1010& df.two_parity$CowId == 179), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1025& df.two_parity$CowId == 197), ]
#112 obs 7 variables
# Select the first parity
df.test <- df.two_parity %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation))
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE, sort = F) #5173 obs of 64 variables
summary(df.three)
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
#5169 obs if 64v
df.three <- df.three %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation)) #5113 pbs 64v
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5069 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4815 obs
summary(df.three)
# Exclude cows without DFC_CLA
df.three <- df.three[!is.na(df.three$DFC_CLA), ] #4754 obs
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4692 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4677obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4672 obs
summary(df.three)
# Select cows with 2 parities
#df.three$farmcow <- paste(df.three$FarmNo, df.three$CowId, sep="")
#df.three_twoparity <- df.three %>%
#mutate(farmcow.dup = ifelse(duplicated(farmcow)| duplicated(farmcow,  fromLast=TRUE), 1, 0)) %>%
#filter(farmcow.dup == 1) #102 obs
####################
# Ready data frame #
####################
Three <- df.three #4724 obs of 64v
#TWoParity <- df.three_twoparity #102 obs of 65v
#rm(list = ls(pattern = "df"))
#rm(list = ls(pattern = "all_"))
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE, sort = F) #5173 obs 64v
summary(df.three)
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation)) #5113 pbs 64v
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5069 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4815 obs
summary(df.three)
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4692 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4677obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4672 obs
summary(df.three)
summary(df.three)
####################
# Ready data frame #
####################
Three <- df.three #4672 obs of 64v
####################
# Ready data frame #
####################
Three <- df.three #4672 obs of 64v
#TWoParity <- df.three_twoparity #102 obs of 65v
#rm(list = ls(pattern = "df"))
#rm(list = ls(pattern = "all_"))
####################
# Ready data frame #
####################
Three <- df.three #4672 obs of 64v
#################################
#  Merge ketosis, reproduction  #
#################################
df.two <- merge(reproduction, ketosis,
by = c('FarmNo', 'CowId', 'Lactation'),
all.x = TRUE, all.y = TRUE, sort = F) %>%
#5230 obs of 50 variables
distinct(FarmNo, CowId, Lactation, CalvingDate, .keep_all = T) #5173 obs
summary(df.two)
df.two$CalvingDate <- as.Date(df.two$CalvingDate)
# Check if there are duplicated cows -> 60 duplicated cows
df.two$farmcow <- paste(df.two$FarmNo, df.two$CowId, sep="")
# Select cows with 2 parities
df.two_parity <- df.two %>%
mutate(farmcow.dup = ifelse(duplicated(farmcow)|
duplicated(farmcow,
fromLast=TRUE), 1, 0)) %>%
filter(farmcow.dup == 1) #120 obs of 52 variables
# Check if reproduction data and ketosis are in the same parity
df.two_parity$MedianSampleTime.x <- as.Date(df.two_parity$MedianSampleTime.x)
df.two_parity <- df.two_parity %>%
select(FarmNo, CowId, Lactation, CalvingDate, MedianSampleTime.x, farmcow.dup) %>%
mutate(sample.calving = difftime(MedianSampleTime.x, CalvingDate, units="days")) # Only 4 cows did not have info for one of the parities -> remove these 4 records
# Farm1002, cow 1813
# Farm1002, cow 1817
# Farm1010, cow 179
# Farm1025, cow 197
df.two_parity <- df.two_parity[-which(df.two_parity$CowId == 1813), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1002& df.two_parity$CowId == 1817), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1010& df.two_parity$CowId == 179), ]
df.two_parity <- df.two_parity[-which(df.two_parity$FarmNo == 1025& df.two_parity$CowId == 197), ]
#112 obs 7 variables
# Select the first parity
df.test <- df.two_parity %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation))
###########################################
#  Merge ketosis, reproduction, and milk  #
###########################################
df.three <- merge(df.two, milk, by = c('FarmNo', 'CowId', 'Lactation', 'CalvingDate'),
all.x = TRUE, all.y = TRUE, sort = F) #5173 obs 64v
summary(df.three)
df.three$MedianSampleTime.x <- as.Date(df.three$MedianSampleTime.x)
# Exclude cows without data based on the repeated 4 cows
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1813 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1002 & df.three$CowId == 1817 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1010 & df.three$CowId == 179 & is.na(df.three$MedianSampleTime.x)), ]
df.three <- df.three[-which(df.three$FarmNo == 1025 & df.three$CowId == 197 & is.na(df.three$MedianSampleTime.x)), ]
#5169 obs if 64v
df.three <- df.three %>%
group_by(FarmNo, CowId) %>%
filter(Lactation == min(Lactation)) #5113 pbs 64v
# Exculde cows without CalvingDate
df.three <- df.three[!is.na(df.three$CalvingDate), ] #5069 obs
# Exclude rows that have been culled within 150 DIM
df.three <- df.three[-which(df.three$cull.calving < 150), ] #4815 obs
summary(df.three)
# Exclude cows without DFC_CLA
df.three <- df.three[!is.na(df.three$DFC_CLA), ] #4754 obs
# Exclude cows with DFC_CLA less than 20 and more than 200
df.three <- df.three[-which(df.three$DFC_CLA < 20 | df.three$DFC_CLA > 200), ] #4692 obs
# Exclude cows DaysToFirstIns <20 DIM and >250 DIM
df.three <- df.three[-which(df.three$DaysToFirstIns < 20 | df.three$DaysToFirstIns >250), ] #4677obs
### Exclude cows DFCFirstHeat <20 DIM and >200 DIM
df.three <- df.three[-which(df.three$DFCFirstHeat < 20 | df.three$DFCFirstHeat > 200), ] #4672 obs
summary(df.three)
# Select cows with 2 parities
#df.three$farmcow <- paste(df.three$FarmNo, df.three$CowId, sep="")
#df.three_twoparity <- df.three %>%
#mutate(farmcow.dup = ifelse(duplicated(farmcow)| duplicated(farmcow,  fromLast=TRUE), 1, 0)) %>%
#filter(farmcow.dup == 1) #102 obs
####################
# Ready data frame #
####################
Three <- df.three #4672 obs of 64v
#TWoParity <- df.three_twoparity #102 obs of 65v
#rm(list = ls(pattern = "df"))
#rm(list = ls(pattern = "all_"))
#TWoParity <- df.three_twoparity #102 obs of 65v
rm(list = ls(pattern = "df"))
rm(list = ls(pattern = "all_"))
