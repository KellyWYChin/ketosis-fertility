---
title: "Poisson regression"
author: "Kelly Chin"
date: "4/17/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# R libraries
```{r}
library(readxl)
library(performance)
library(survival)
library(survminer)
library(tidyr)
library(gtsummary)
library(coxme)
library(lme4)
library(nlme)
```

```{r}
Three <- read_excel("../data/raw/Three.xlsx")
Three$CalvingYear <- as.factor(ifelse(Three$CalvingYear == 2018, 1, 2))

```

# Research Question: what is the assocation of numbers of AI and ketosis?

# AvgKeto20_100
```{r}
p.mod1 <- glm(Last_AI ~ AvgKeto20_100 + ad_Lactation + PeakDFC + AvgMY60 + CalvingSeason + factor(FarmNo), family = poisson(link = "log"), data = Three)
summary(p.mod1)

plot(p.mod1)
```

## Random effect
```{r}
mod1.lme <- lme(DFCFirstHeat ~ AvgKeto20_atleast10 + MaxKetoDFC20 + factor(ad_Lactation) + PeakDFC + AvgMY20 + CalvingSeason, 
                random = ~ 1|FarmNo, 
                data = Three, 
                na.action = na.exclude,
                method = "REML")
summary(mod1.lme)
```
```{r}
mod1.poisson <- glmer(DFCFirstHeat ~ AvgKeto20_atleast10 + MaxKetoDFC20 + factor(ad_Lactation) + PeakDFC + AvgMY20 + CalvingSeason + (1 | FarmNo), 
                      data = Three, family = poisson(link = "log"))
```

# KetoDur20
```{r}
p.mod2 <- glm(Last_AI ~ KetoDur20 + factor(ad_Lactation) + PeakDFC + AvgMY60 + CalvingSeason + factor(FarmNo), family = poisson(link = "log"), data = Three)
summary(p.mod2)
plot(p.mod2)

p.mod2_no_Lact <- glm(Last_AI ~ KetoDur20 + PeakDFC + AvgMY60 + CalvingSeason + factor(FarmNo), family = poisson(link = "log"), data = Three) 
summary(p.mod2_no_Lact)
plot(p.mod2_no_Lact)
```
