---
title: "Correlation"
author: "Kelly Chin"
date: "3/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# R libraries
```{r library, message=FALSE, warning=FALSE}
library(readxl)
library(tidyr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(reader)
library(lubridate)
library(docstring)
library(roxygen2)
library(corrplot)
library(psych)
``` 

# Correlation in farm info, ketosis, reproduction, milk yield
```{r}
Three <- read_excel("../data/raw/Three.xlsx")

df.farm <- Three %>%
  select(FarmNo, CowId, CowNo, Lactation, ad_Lactation)
str(df.farm)
df.farm$FarmNo <- as.integer(df.farm$FarmNo)
cor.farm <- cor(df.farm)
cor.farm
corrplot(cor.farm, 
         tl.col = "brown",
         tl.srt = 45, bg = "White",
         title = "\n\n Correlation plot of farm info",
         addCoef.col = "black",
         type = "lower")

df.repro <- Three %>%
  select(CowId, DaysToCLA, DaysToFirstHeat, DaysToFirstIns, NumAI, ad_Lactation)
str(df.repro)
cor.repro <- cor(na.omit(df.repro))
cor.repro
corrplot(cor.repro,
         tl.col = "brown",
         tl.srt = 45, bg = "white",
         title = "\n\n Correlation plot of reproduction parameters",
         addCoef.col = "black",
         type = "lower")

df.repro$ad_Lactation <- as.factor(df.repro$ad_Lactation)
pairs(df.repro, 
      labels = colnames(df.repro),
      pch = 21, 
      bg = rainbow(4)[df.repro$ad_Lactation],
      col = rainbow(4)[df.repro$ad_Lactation],
      main = "df.repro",
      rowlattop = TRUE,
      gap = 1,
      cex.labels = NULL,
      font.labels = 1)

df.keto20 <- Three %>%
  select(CowId, AvgKeto20_atleast10, KetoDur20, MaxKetoDFC20, nHighKeto20)
cor.keto20 <- cor(na.omit(df.keto20))
cor.keto20
corrplot(cor.keto20,
         tl.col = "brown",
         tl.srt = 45, bg = "white",
         title = "\n\n Correlation plot of ketosis parameters",
         addCoef.col = "black",
         type = "lower")

df.keto60 <- Three %>%
  select(CowId, AvgKeto60_atleast10, KetoDur60, MaxKetoDIM60, nHighKeto60)
cor.keto60 <- cor(na.omit(df.keto60))
cor.keto60
corrplot(cor.keto60,
         tl.col = "brown",
         tl.srt = 45, bg = "white",
         title = "\n\n Correlation plot of ketosis parameters",
         addCoef.col = "black",
         type = "lower")

df.milk <- Three %>%
  select(CowId, PeakMY, PeakDFC, AvgMY20, SumMY20, AvgMY60, SumMY60)
cor.milk60 <- cor(na.omit(df.milk))
cor.milk60
corrplot(cor.milk60,
         tl.col = "brown",
         tl.srt = 45, bg = "white",
         title = "\n\n Correlation plot of milk parameters",
         addCoef.col = "black",
         type = "lower")
```

# Reproduction parameters
```{r}
plot(Three$DaysToCLA, Three$DaysToFirstHeat, 
     main = "Scatterplot of time to first cyclicity and first heat", 
     xlab = "time to first cyclicity",
     ylab = "time to first heat", pch = 19)

plot(Three$DaysToFirstHeat, Three$DaysToFirstIns, 
     main = "Scatterplot of time to first heat and first AI", 
     xlab = "time to frist heat", 
     ylab = "time to first AI", pch = 19)

plot(Three$DaysToCLA, Three$DaysToFirstIns, 
     main = "Scatterplot of time to first cyclicity and first AI", 
     xlab = "time to frist cyclicity", 
     ylab = "time to first AI", pch = 19)

plot(Three$ad_Lactation, Three$DaysToCLA,
     main = "Scatterplot of Lactation and time to first cyclicity",
     xlab = "Adjusted lacation groups",
     ylab = "time to first cyclicity", pch = 19)
```
```{r}
# Split data with different lactation groups
df.parity1 <- Three %>% 
  filter(ad_Lactation == 1) #1277 obs 65v
df.parity2 <- Three %>%
  filter(ad_Lactation == 2) #1106 obs 65v
df.parity3 <- Three %>%
  filter(ad_Lactation == 3) #803 obs 65v
df.parity4 <- Three %>%
  filter(ad_Lactation == 4) #1141 obs 65v
```

## Reproduction parameters - DaysToCLA vs DaysToFirstHeat
```{r}
par(mfrow = c(1, 4))
plot(df.parity1$DaysToCLA, df.parity1$DaysToFirstHeat, 
     #main = "time to first cyclicity and first heat in first lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first heat (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstHeat~df.parity1$DaysToCLA))

plot(df.parity2$DaysToCLA, df.parity2$DaysToFirstHeat, 
     #main = "time to first cyclicity and first heat in second lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first heat (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstHeat~df.parity2$DaysToCLA), col = "red")

plot(df.parity3$DaysToCLA, df.parity3$DaysToFirstHeat, 
     #main = "time to first cyclicity and first heat in third lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first heat (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstHeat~df.parity3$DaysToCLA), col = "green")

plot(df.parity4$DaysToCLA, df.parity4$DaysToFirstHeat, 
     #main = "time to first cyclicity and first heat in third lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first heat (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstHeat~df.parity4$DaysToCLA), col = "blue")

## Pearson correlation
cor(df.parity1$DaysToFirstHeat, df.parity1$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity2$DaysToFirstHeat, df.parity2$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity3$DaysToFirstHeat, df.parity3$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity4$DaysToFirstHeat, df.parity4$DaysToCLA, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$DaysToFirstHeat, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity2$DaysToFirstHeat, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity3$DaysToFirstHeat, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity4$DaysToFirstHeat, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")

cor.test(df.parity1$DaysToFirstHeat, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity2$DaysToFirstHeat, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity3$DaysToFirstHeat, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity4$DaysToFirstHeat, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")
```

## Reproduction parameters - DaysToCLA vs DaysToFirstIns
```{r}
par(mfrow = c(1, 4))
plot(df.parity1$DaysToCLA, df.parity1$DaysToFirstIns, 
     #main = "time to first cyclicity and first AI in first lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first AI (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstIns~df.parity1$DaysToCLA))

plot(df.parity2$DaysToCLA, df.parity2$DaysToFirstIns, 
     #main = "time to first cyclicity and first AI in second lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first AI (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstIns~df.parity2$DaysToCLA), col = "red")

plot(df.parity3$DaysToCLA, df.parity3$DaysToFirstIns, 
     #main = "time to first cyclicity and first AI in third lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first AI (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstIns~df.parity3$DaysToCLA), col = "green")

plot(df.parity4$DaysToCLA, df.parity4$DaysToFirstIns, 
     #main = "time to first cyclicity and first AI in third lactation", 
     xlab = "time to first cyclicity",
     ylab = "time to first AI (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstIns~df.parity4$DaysToCLA), col = "blue")

## Pearson correlation
cor(df.parity1$DaysToFirstIns, df.parity1$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity2$DaysToFirstIns, df.parity2$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity3$DaysToFirstIns, df.parity3$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity4$DaysToFirstIns, df.parity4$DaysToCLA, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$DaysToFirstIns, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity2$DaysToFirstIns, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity3$DaysToFirstIns, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity4$DaysToFirstIns, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")

cor.test(df.parity1$DaysToFirstIns, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity2$DaysToFirstIns, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity3$DaysToFirstIns, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity4$DaysToFirstIns, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")
```

## Reproduction parameters - DaysToFirstHeat vs DaysToFirstIns
```{r}
plot(Three$DaysToFirstHeat, Three$DaysToFirstIns, 
     main = "Scatterplot of time to first heat and first AI", 
     xlab = "time to frist heat", 
     ylab = "time to first AI", pch = 19)
abline(lm(Three$DaysToFirstIns~Three$DaysToFirstHeat), col = "red")
cor.test(Three$DaysToFirstIns, Three$DaysToFirstHeat, use = "complete.obs", method = "spearman")

par(mfrow = c(1, 4))
plot(df.parity1$DaysToFirstHeat, df.parity1$DaysToFirstIns, 
     #main = "time to first heat and first AI", 
     xlab = "time to frist heat",
     ylab = "time to first AI (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstIns~df.parity1$DaysToFirstHeat))

plot(df.parity2$DaysToFirstHeat, df.parity2$DaysToFirstIns, 
     #main = "time to first heat and first AI", 
     xlab = "time to frist heat",
     ylab = "time to first AI (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstIns~df.parity2$DaysToFirstHeat), col = "red")

plot(df.parity3$DaysToFirstHeat, df.parity3$DaysToFirstIns, 
     #main = "time to first heat and first AI", 
     xlab = "time to frist heat",
     ylab = "time to first AI (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstIns~df.parity3$DaysToFirstHeat), col = "green")

plot(df.parity4$DaysToFirstHeat, df.parity4$DaysToFirstIns, 
     #main = "time to first heat and first AI", 
     xlab = "time to frist heat",
     ylab = "time to first AI (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstIns~df.parity4$DaysToFirstHeat), col = "blue")

## Pearson correlation
cor(df.parity1$DaysToFirstIns, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity2$DaysToFirstIns, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity3$DaysToFirstIns, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity4$DaysToFirstIns, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$DaysToFirstIns, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity2$DaysToFirstIns, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity3$DaysToFirstIns, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity4$DaysToFirstIns, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")

cor.test(df.parity1$DaysToFirstIns, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity2$DaysToFirstIns, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity3$DaysToFirstIns, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity4$DaysToFirstIns, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")
```

# Ketosis parameters
## 20 DIM
### AvgKeto20_atleast10 vs KetoDur20
```{r}
plot(Three$AvgKeto20_atleast10, Three$KetoDur20, 
     main = "Scatterplot of Avg milk BHB and ketosis duration within 20 DIM", 
     xlab = "Average milk BHB (mmol/L)",
     ylab = "Duraiton (days)", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$KetoDur20~Three$AvgKeto20_atleast10), col = "blue")

## Pearson correlation
cor(Three$AvgKeto20_atleast10, Three$KetoDur20, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(Three$AvgKeto20_atleast10, Three$KetoDur20, use = "complete.obs", method = "spearman")
cor.test(Three$AvgKeto20_atleast10, Three$KetoDur20, use = "complete.obs", method = "spearman")
```

### AvgKeto20_atleast10 vs MaxKetoDIM20
```{r}
plot(Three$AvgKeto20_atleast10, Three$MaxKetoDIM20, 
     main = "Scatterplot of Avg milk BHB and max milk BHB within 20 DIM", 
     ylab = "DIM of max milk BHB (mmol/L)",
     xlab = "Average milk BHB (mmol/L)", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$MaxKetoDIM20~Three$AvgKeto20_atleast10), col = "blue")

## Pearson correlation
cor(Three$AvgKeto20_atleast10, Three$MaxKetoDIM20, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(Three$AvgKeto20_atleast10, Three$MaxKetoDIM20, use = "complete.obs", method = "spearman")
cor.test(Three$AvgKeto20_atleast10, Three$MaxKetoDIM20, use = "complete.obs", method = "spearman")
```

### AvgKeto20_atleast10 vs nHighKeto20
```{r}
plot(Three$AvgKeto20_atleast10, Three$nHighKeto20,
     main = "Scatterplot of Avg milk BHB and #milk BHB over threshold within 20 DIM", 
     xlab = "Average milk BHB (mmol/L)",
     ylab = "#milk BHB over 0.08 mmol/L", pch = 19)
abline(v = 0.08, col = "red")

## Pearson correlation
cor(Three$AvgKeto20_atleast10, Three$nHighKeto20, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(Three$AvgKeto20_atleast10, Three$nHighKeto20, use = "complete.obs", method = "spearman")
cor.test(Three$AvgKeto20_atleast10, Three$nHighKeto20, use = "complete.obs", method = "spearman")
```

### KetoDur20 vs nHighKeto20
```{r}
plot(Three$KetoDur20, Three$nHighKeto20,
     main = "Scatterplot of ketosis duration and #milk BHB over threshold within 20 DIM", 
     xlab = "Duration (days)",
     ylab = "#milk BHB over 0.08 mmol/L", pch = 19)
abline(v = 0.08, col = "red")

## Pearson correlation
cor(Three$KetoDur20, Three$nHighKeto20, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(Three$KetoDur20, Three$nHighKeto20, use = "complete.obs", method = "spearman")
cor.test(Three$KetoDur20, Three$nHighKeto20, use = "complete.obs", method = "spearman")
```

## 60 DIM
```{r}
### AvgKeto60_atleast10 vs KetoDur60
plot(Three$AvgKeto60_atleast10, Three$KetoDur60, 
     main = "Scatterplot of Avg milk BHB and ketosis duration within 60 DIM", 
     xlab = "Average milk BHB (mmol/L)",
     ylab = "Duraiton (days)", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$KetoDur60~Three$AvgKeto60_atleast10), col = "blue")

# Pearson correlation
cor(Three$AvgKeto60_atleast10, Three$KetoDur60, use = "complete.obs", method = "pearson")

# Spearman correlation
cor(Three$AvgKeto60_atleast10, Three$KetoDur60, use = "complete.obs", method = "spearman")
cor.test(Three$AvgKeto60_atleast10, Three$KetoDur60, use = "complete.obs", method = "spearman")


### AvgKeto60_atleast10 vs MaxKetoDIM60
plot(Three$AvgKeto60_atleast10, Three$MaxKetoDIM60, 
     main = "Scatterplot of Avg milk BHB and max milk BHB within 60 DIM", 
     ylab = "DIM of max milk BHB (mmol/L)",
     xlab = "Average milk BHB (mmol/L)", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$MaxKetoDIM60~Three$AvgKeto60_atleast10), col = "blue")

# Pearson correlation
cor(Three$AvgKeto60_atleast10, Three$MaxKetoDIM60, use = "complete.obs", method = "pearson")

# Spearman correlation
cor(Three$AvgKeto60_atleast10, Three$MaxKetoDIM60, use = "complete.obs", method = "spearman")
cor.test(Three$AvgKeto60_atleast10, Three$MaxKetoDIM60, use = "complete.obs", method = "spearman")


### AvgKeto60_atleast10 vs nHighKeto60
plot( Three$AvgKeto60_atleast10, Three$nHighKeto60,
     main = "Scatterplot of Avg milk BHB and #milk BHB over threshold within 60 DIM", 
     xlab = "Average milk BHB (mmol/L)",
     ylab = "#milk BHB over 0.08 mmol/L", pch = 19)
abline(v = 0.08, col = "red")

# Pearson correlation
cor(Three$AvgKeto60_atleast10, Three$nHighKeto60, use = "complete.obs", method = "pearson")

# Spearman correlation
cor(Three$AvgKeto60_atleast10, Three$nHighKeto60, use = "complete.obs", method = "spearman")
cor.test(Three$AvgKeto60_atleast10, Three$nHighKeto60, use = "complete.obs", method = "spearman")

### KetoDur60 vs nHighKeto60
plot(Three$KetoDur60, Three$nHighKeto60,
     main = "Scatterplot of ketosis duration and #milk BHB over threshold within 60 DFC", 
     xlab = "Duration (days)",
     ylab = "#milk BHB over 0.08 mmol/L", pch = 19)
abline(v = 0.08, col = "red")

# Pearson correlation
cor(Three$KetoDur60, Three$nHighKeto60, use = "complete.obs", method = "pearson")

# Spearman correlation
cor(Three$KetoDur60, Three$nHighKeto60, use = "complete.obs", method = "spearman")
cor.test(Three$KetoDur60, Three$nHighKeto60, use = "complete.obs", method = "spearman")
```

# Milk parameters
```{r}
## PeakDFC vs PeakMY
plot(Three$PeakDFC, Three$PeakMY, 
     main = "Scatterplot of peak DFC and peak MY", 
     xlab = "DIM when milk yield reached the peak",
     ylab = "Peak milk yield (kg)", pch = 19)
abline(lm(Three$PeakMY~Three$PeakDFC), col = "blue")

# Pearson correlation
cor(Three$PeakDFC, Three$PeakMY, use = "complete.obs", method = "pearson")
# Spearman correlation
cor(Three$PeakDFC, Three$PeakMY, use = "complete.obs", method = "spearman")
cor.test(Three$PeakDFC, Three$PeakMY, use = "complete.obs", method = "spearman")

## PeakMY vs AvgMY20
plot(Three$AvgMY20, Three$PeakMY, 
     main = "Scatterplot of average MY in 20 DIM and peak MY", 
     xlab = "Average milk yield in 20 DIM",
     ylab = "Peak milk yield", pch = 19)
abline(lm(Three$PeakMY~Three$AvgMY20), col = "blue")

# Pearson correlation
cor(Three$AvgMY20, Three$PeakMY, use = "complete.obs", method = "pearson")
cor.test(Three$AvgMY20, Three$PeakMY, use = "complete.obs", method = "pearson")

## PeakMY vs AvgMY60
plot(Three$AvgMY60, Three$PeakMY, 
     main = "Scatterplot of average MY in 60 DIM and peak MY", 
     xlab = "Average milk yield in 60 DIM",
     ylab = "Peak milk yield", pch = 19)
abline(lm(Three$PeakMY~Three$AvgMY60), col = "blue")

# Pearson correlation
cor(Three$AvgMY60, Three$PeakMY, use = "complete.obs", method = "pearson")
cor.test(Three$AvgMY60, Three$PeakMY, use = "complete.obs", method = "pearson")

## PeakDFC vs AvgMY20
plot(Three$AvgMY20, Three$PeakDFC, 
     main = "Scatterplot of average MY in 20 DIM and peak DIM", 
     xlab = "Average milk yield in 20 DIM",
     ylab = "DIM peak milk yield", pch = 19)
abline(lm(Three$PeakDFC~Three$AvgMY20), col = "blue")

# Pearson correlation
cor(Three$AvgMY20, Three$PeakDFC, use = "complete.obs", method = "pearson")
cor.test(Three$AvgMY20, Three$PeakDFC, use = "complete.obs", method = "pearson")

```

# Bivariables
# Reproduction + ketosis parameters
```{r}
df.repro.keto <- Three %>%
  select(DaysToCLA, DaysToFirstHeat, NumAI, AvgKeto20_atleast10, KetoDur20, nHighKeto20, AvgKeto60_atleast10, KetoDur60, nHighKeto60)
cor.repro.keto <- cor(na.omit(df.repro.keto))
cor.repro.keto
corrplot(cor.repro.keto,
         tl.col = "brown",
         tl.srt = 50, bg = "white",
         title = "\n\n Correlation plot of reproduction and ketosis parameters",
         addCoef.col = "black", number.cex = 0.75,
         type = "lower")
```

## Reproduction + Ketosis parameters - LastAI vs AvgKeto20_atleast10
```{r}
plot(Three$AvgKeto20_atleast10, Three$NumAI, 
     main = "#AI and average milk BHB within 20 DIM",
     xlab = "Average milk BHB within 20 DIM",
     ylab = "#AI", pch = 19)
abline(v = 0.08, col = "red")

cor.test(Three$AvgKeto20_atleast10, Three$NumAI, use = "complete.obs", method = "spearman")


par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto20_atleast10, df.parity1$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 20 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto20 (lactation = 1)", pch = 19)
abline(lm(df.parity1$NumAI~df.parity1$AvgKeto20_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto20_atleast10, df.parity2$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 20 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto20 (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$NumAI~df.parity2$AvgKeto20_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto20_atleast10, df.parity3$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 20 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto20 (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$NumAI~df.parity3$AvgKeto20_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto20_atleast10, df.parity4$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 20 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto20 (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$NumAI~df.parity4$AvgKeto20_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto20_atleast10, df.parity1$NumAI, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto20_atleast10, df.parity2$NumAI, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto20_atleast10, df.parity3$NumAI, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto20_atleast10, df.parity4$NumAI, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto20_atleast10, df.parity1$NumAI, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto20_atleast10, df.parity2$NumAI, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto20_atleast10, df.parity3$NumAI, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto20_atleast10, df.parity4$NumAI, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto20_atleast10, df.parity1$NumAI, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto20_atleast10, df.parity2$NumAI, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto20_atleast10, df.parity3$NumAI, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto20_atleast10, df.parity4$NumAI, use = "complete.obs", method = "spearman")
```

## Reproduction + Ketosis parameters - LastAI vs AvgKeto60_atleast10
```{r}
plot(Three$AvgKeto60_atleast10, Three$NumAI, 
     main = "#AI and average milk BHB within 60 DIM",
     xlab = "Average milk BHB within 60 DIM",
     ylab = "#AI", pch = 19)
abline(v = 0.08, col = "red")

cor.test(Three$AvgKeto60_atleast10, Three$NumAI, use = "complete.obs", method = "spearman")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto60_atleast10, df.parity1$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 60 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto60 (lactation = 1)", pch = 19)
abline(lm(df.parity1$NumAI~df.parity1$AvgKeto60_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto60_atleast10, df.parity2$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 60 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto60 (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$NumAI~df.parity2$AvgKeto60_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto60_atleast10, df.parity3$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 60 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto60 (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$NumAI~df.parity3$AvgKeto60_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto60_atleast10, df.parity4$NumAI, 
     #main = "Scatterplot of number of AI and average milk BHB within 60 DIM", 
     ylab = "#AI",
     xlab = "AvgKeto60 (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$NumAI~df.parity4$AvgKeto60_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$NumAI, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$NumAI, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$NumAI, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$NumAI, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$NumAI, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$NumAI, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$NumAI, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$NumAI, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto60_atleast10, df.parity1$NumAI, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto60_atleast10, df.parity2$NumAI, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto60_atleast10, df.parity3$NumAI, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto60_atleast10, df.parity4$NumAI, use = "complete.obs", method = "spearman")
```

## Reproduction + Ketosis parameters - DaysToFirstHeat vs nHighKeto20
```{r}
plot(Three$nHighKeto20, Three$DaysToFirstHeat, 
     main = "Scatterplot of count milk BHB levels over threshold within 20 DIM and time to first heat",
     xlab = "Number of time milk BHB over threshold within 20 DIM",
     ylab = "DIM to first heat", pch = 19)

par(mfrow = c(2, 2))
plot(df.parity1$nHighKeto20, df.parity1$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "nHighKeto20 (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstHeat~df.parity1$nHighKeto20))

plot(df.parity2$nHighKeto20, df.parity2$DaysToFirstHeat, 
     #main = "DIM to first heat and average milk BHB within 20 time", 
     ylab = "time to first heat",
     xlab = "nHighKeto20 (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstHeat~df.parity2$nHighKeto20), col = "red")

plot(df.parity3$nHighKeto20, df.parity3$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "nHighKeto20 (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstHeat~df.parity3$nHighKeto20), col = "green")

plot(df.parity4$nHighKeto20, df.parity4$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "nHighKeto20 (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstHeat~df.parity4$nHighKeto20), col = "blue")

## Pearson correlation
cor(df.parity1$nHighKeto20, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity2$nHighKeto20, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity3$nHighKeto20, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity4$nHighKeto20, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$nHighKeto20, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity2$nHighKeto20, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity3$nHighKeto20, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity4$nHighKeto20, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")

cor.test(df.parity1$nHighKeto20, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity2$nHighKeto20, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity3$nHighKeto20, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity4$nHighKeto20, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")
```

## Reproduction + Ketosis parameters - DaysToFirstHeat vs AvgKeto20_atleast10
```{r}
## DaysToFirstHeat vs Average milk BHB levels
plot(Three$AvgKeto20_atleast10, Three$DaysToFirstHeat, 
     main = "Average milk BHB levels and time to first heat",
     xlab = "AvgKeto20 (mmol/L)",
     ylab = "time to first heat", pch = 19)
abline(v = 0.08, col = "red")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto20 (mmol/L) (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstHeat~df.parity1$AvgKeto20_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto20 (mmol/L) (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstHeat~df.parity2$AvgKeto20_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto20 (mmol/L) (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstHeat~df.parity3$AvgKeto20_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 20 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto20 (mmol/L) (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstHeat~df.parity4$AvgKeto20_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")

```

## Reproduction + Ketosis parameters - DaysToFirstHeat vs AvgKeto60_atleast10
```{r}
## DaysToFirstHeat vs Average milk BHB levels
plot(Three$AvgKeto60_atleast10, Three$DaysToFirstHeat, 
     main = "Average milk BHB levels and time to first heat",
     xlab = "AvgKeto60 (mmol/L)",
     ylab = "time to first heat", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$DaysToFirstHeat~Three$AvgKeto60_atleast10), col = "blue")

cor.test(Three$AvgKeto60_atleast10, Three$DaysToFirstHeat, use = "complete.obs", method = "spearman")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 60 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto60 (mmol/L) (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstHeat~df.parity1$AvgKeto60_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 60 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto60 (mmol/L) (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstHeat~df.parity2$AvgKeto60_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 60 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto60 (mmol/L) (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstHeat~df.parity3$AvgKeto60_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstHeat, 
     #main = "time to first heat and average milk BHB within 60 DIM", 
     ylab = "time to first heat",
     xlab = "AvgKeto60 (mmol/L) (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstHeat~df.parity4$AvgKeto60_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstHeat, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstHeat, use = "complete.obs", method = "spearman")

```

## Reproduction + Ketosis parameters - DaysToFirstIns vs AvgKeto20_atleast10
```{r}
## DaysToFirstIns vs Average milk BHB levels
plot(Three$AvgKeto20_atleast10, Three$DaysToFirstIns, 
     main = "Average milk BHB levels and time to first AI",
     xlab = "AvgKeto20 (mmol/L)",
     ylab = "time to first AI", pch = 19)
abline(v = 0.08, col = "red")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 20 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto20 (mmol/L) (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstIns~df.parity1$AvgKeto20_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 20 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto20 (mmol/L) (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstIns~df.parity2$AvgKeto20_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 20 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto20 (mmol/L) (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstIns~df.parity3$AvgKeto20_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 20 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto20 (mmol/L) (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstIns~df.parity4$AvgKeto20_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstIns, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstIns, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstIns, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstIns, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstIns, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto20_atleast10, df.parity1$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto20_atleast10, df.parity2$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto20_atleast10, df.parity3$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto20_atleast10, df.parity4$DaysToFirstIns, use = "complete.obs", method = "spearman")

```

## Reproduction + Ketosis parameters - DaysToFirstIns vs AvgKeto60_atleast10
```{r}
## DaysToFirstIns vs Average milk BHB levels
plot(Three$AvgKeto60_atleast10, Three$DaysToFirstIns, 
     main = "Average milk BHB levels and time to first AI",
     xlab = "AvgKeto60 (mmol/L)",
     ylab = "time to first AI", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$DaysToFirstIns~Three$AvgKeto60_atleast10), col = "blue")

cor.test(Three$AvgKeto60_atleast10, Three$DaysToFirstIns, use = "complete.obs", method = "spearman")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 60 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto60 (mmol/L) (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToFirstIns~df.parity1$AvgKeto60_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 60 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto60 (mmol/L) (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToFirstIns~df.parity2$AvgKeto60_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 60 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto60 (mmol/L) (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToFirstIns~df.parity3$AvgKeto60_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstIns, 
     #main = "time to first AI and average milk BHB within 60 DIM", 
     ylab = "time to first AI",
     xlab = "AvgKeto60 (mmol/L) (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToFirstIns~df.parity4$AvgKeto60_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstIns, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstIns, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstIns, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstIns, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstIns, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToFirstIns, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToFirstIns, use = "complete.obs", method = "spearman")

``` 

## Reproduction + Ketosis parameters - DaysToCLA vs AvgKeto60_atleast10
```{r}
## DaysToCLA vs Average milk BHB levels
plot(Three$AvgKeto60_atleast10, Three$DaysToCLA, 
     main = "Average milk BHB levels and time to first cyclicity",
     xlab = "AvgKeto60 (mmol/L)",
     ylab = "time to first cyclicity", pch = 19)
abline(v = 0.08, col = "red")
cor.test(Three$AvgKeto60_atleast10, Three$DaysToCLA, use = "complete.obs", method = "spearman")


par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 60 DIM", 
     ylab = "time to first cyclicity",
     xlab = "AvgKeto60 (mmol/L) (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToCLA~df.parity1$AvgKeto60_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 60 DIM", 
     ylab = "time to first cyclicity",
     xlab = "AvgKeto60 (mmol/L) (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToCLA~df.parity2$AvgKeto60_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 60 DIM", 
     ylab = "time to first cyclicity",
     xlab = "AvgKeto60 (mmol/L) (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToCLA~df.parity3$AvgKeto60_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 60 DIM", 
     ylab = "time to first cyclicity",
     xlab = "AvgKeto60 (mmol/L) (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToCLA~df.parity4$AvgKeto60_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToCLA, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")

cor.test(df.parity1$AvgKeto60_atleast10, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto60_atleast10, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto60_atleast10, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto60_atleast10, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")

```

## Reproduction + Ketosis parameters - DaysToCLA vs nHighKeto20
```{r}
plot(Three$nHighKeto20, Three$DaysToCLA, 
     main = "Scatterplot of count milk BHB levels over threshold within 20 DIM and time to first cyclicity",
     xlab = "Number of time milk BHB over threshold within 20 DIM",
     ylab = "time to first cyclicity", pch = 19)

par(mfrow = c(2, 2))
plot(df.parity1$nHighKeto20, df.parity1$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 20 DIM", 
     ylab = "time to first cyclicity",
     xlab = "nHighKeto20 (lactation = 1)", pch = 19)
abline(lm(df.parity1$DaysToCLA~df.parity1$nHighKeto20))

plot(df.parity2$nHighKeto20, df.parity2$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 20 DIM", 
     ylab = "time to first cyclicity",
     xlab = "nHighKeto20 (lactation = 2)", pch = 19, col = "red")
abline(lm(df.parity2$DaysToCLA~df.parity2$nHighKeto20), col = "red")

plot(df.parity3$nHighKeto20, df.parity3$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 20 DIM", 
     ylab = "time to first cyclicity",
     xlab = "nHighKeto20 (lactation = 3)", pch = 19, col = "green")
abline(lm(df.parity3$DaysToCLA~df.parity3$nHighKeto20), col = "green")

plot(df.parity4$nHighKeto20, df.parity4$DaysToCLA, 
     #main = "time to first cyclicity and average milk BHB within 20 DIM", 
     ylab = "time to first cyclicity",
     xlab = "nHighKeto20 (lactation = 4+)", pch = 19, col = "blue")
abline(lm(df.parity4$DaysToCLA~df.parity4$nHighKeto20), col = "blue")

## Pearson correlation
cor(df.parity1$nHighKeto20, df.parity1$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity2$nHighKeto20, df.parity2$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity3$nHighKeto20, df.parity3$DaysToCLA, use = "complete.obs", method = "pearson")
cor(df.parity4$nHighKeto20, df.parity4$DaysToCLA, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$nHighKeto20, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity2$nHighKeto20, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity3$nHighKeto20, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor(df.parity4$nHighKeto20, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")

cor.test(df.parity1$nHighKeto20, df.parity1$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity2$nHighKeto20, df.parity2$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity3$nHighKeto20, df.parity3$DaysToCLA, use = "complete.obs", method = "spearman")
cor.test(df.parity4$nHighKeto20, df.parity4$DaysToCLA, use = "complete.obs", method = "spearman")
```

## Reproduction + milk parameters
```{r}
df.repro.milk <- Three %>%
  select(DaysToCLA, DFCFirstAI, NumAI, AvgMY20, SumMY20, AvgMY60, SumMY60)
cor.repro.milk <- cor(na.omit(df.repro.milk))
cor.repro.milk
corrplot(cor.repro.milk,
         tl.col = "brown",
         tl.srt = 50, bg = "white",
         title = "\n\n Correlation plot of reproduction and milk parameters",
         addCoef.col = "black", number.cex = 0.75,
         type = "lower")
```

## DaysToFirstHeat vs AvgMY
```{r}
par(mfrow = c(2, 2))
# DaysToFirstHeat vs AvgMY20
plot(Three$AvgMY20, Three$DaysToFirstHeat,
     #main = "Average milk yield within 20 DFC and DFC to first heat",
     xlab = "AvgMY20 (kg)",
     ylab = "DFC to first heat", pch = 19)
abline(lm(Three$DaysToFirstHeat~Three$AvgMY20), col = "blue")
cor.test(Three$AvgMY20, Three$DaysToFirstHeat, use = "complete.obs", method = "spearman")

# DaysToFirstHeat vs AvgMY60
plot(Three$AvgMY60, Three$DaysToFirstHeat,
     #main = "Average milk yield within 60 DFC and DFC to first heat",
     xlab = "AvgMY60 (kg)",
     ylab = "DFC to first heat", pch = 19)
abline(lm(Three$DaysToFirstHeat~Three$AvgMY60), col = "blue")
cor.test(Three$AvgMY60, Three$DaysToFirstHeat, use = "complete.obs", method = "spearman")

## DaysToFirstIns vs AvgMY20
plot(Three$AvgMY20, Three$DaysToFirstIns,
     #main = "Average milk yield within 20 DFC and DFC to first AI",
     xlab = "AvgMY20 (kg)",
     ylab = "DFC to first AI", pch = 19)
abline(lm(Three$DaysToFirstIns~Three$AvgMY20), col = "blue")
cor.test(Three$AvgMY20, Three$DaysToFirstIns, use = "complete.obs", method = "spearman")

# DaysToFirstIns vs AvgMY60
plot(Three$AvgMY60, Three$DaysToFirstIns,
    #main = "Average milk yield within 60 DFC and DFC to first AI",
     xlab = "AvgMY60 (kg)",
     ylab = "DFC to first AI", pch = 19)
abline(lm(Three$DaysToFirstIns~Three$AvgMY60), col = "blue")
cor.test(Three$AvgMY60, Three$DaysToFirstIns, use = "complete.obs", method = "spearman")
```

# Ketosis + milk parameters
```{r}
df.keto.milk <- Three %>%
  select(AvgKeto20_atleast10, KetoDur20, nHighKeto20, AvgKeto60_atleast10, KetoDur60, nHighKeto60, AvgMY20, SumMY20, AvgMY60, SumMY60)
cor.keto.milk <- cor(na.omit(df.keto.milk))
cor.keto.milk
corrplot(cor.keto.milk,
         tl.col = "brown",
         tl.srt = 50, bg = "white",
         title = "\n\n Correlation plot of ketosis and milk parameters",
         addCoef.col = "black", number.cex = 0.75,
         type = "lower")
```

## Ketosis + MY parameters - AvgKeto20_atleast10 vs AvgMY20
```{r}
plot(Three$AvgKeto20_atleast10, Three$AvgMY20, 
     main = "Scatterplot of average milk yield and DFC to first cyclicity",
     xlab = "Average milk BHB levels within 20 DFC",
     ylab = "Average milk yield in first 20 DFC (L)", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$AvgMY20~Three$AvgKeto20_atleast10), col = "blue")

cor.test(Three$AvgKeto20_atleast10, Three$AvgMY20, use = "complete.obs", method = "spearman")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto20_atleast10, df.parity1$AvgMY20, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto20 (lactation = 1)",
     ylab = "AvgMY20", pch = 19)
abline(lm(df.parity1$AvgMY20~df.parity1$AvgKeto20_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto20_atleast10, df.parity2$AvgMY20, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto20 (lactation = 2)",
     ylab = "AvgMY20", pch = 19, col = "red")
abline(lm(df.parity2$AvgMY20~df.parity2$AvgKeto20_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto20_atleast10, df.parity3$AvgMY20, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto20 (lactation = 3)",
     ylab = "AvgMY20", pch = 19, col = "green")
abline(lm(df.parity3$AvgMY20~df.parity3$AvgKeto20_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto20_atleast10, df.parity4$AvgMY20, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto20 (lactation = 4+)",
     ylab = "AvgMY20", pch = 19, col = "blue")
abline(lm(df.parity4$AvgMY20~df.parity4$AvgKeto20_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgMY20, df.parity1$AvgKeto20_atleast10, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgMY20, df.parity2$AvgKeto20_atleast10, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgMY20, df.parity3$AvgKeto20_atleast10, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgMY20, df.parity4$AvgKeto20_atleast10, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgMY20, df.parity1$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgMY20, df.parity2$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgMY20, df.parity3$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgMY20, df.parity4$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")

## Spearman correlation wtih p-value
cor.test(df.parity1$AvgMY20, df.parity1$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgMY20, df.parity2$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgMY20, df.parity3$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgMY20, df.parity4$AvgKeto20_atleast10, use = "complete.obs", method = "spearman")
```

## Ketosis + MY parameters - AvgKeto60_atleast10 vs AvgMY60
```{r}
plot(Three$AvgKeto60_atleast10, Three$AvgMY60, 
     main = "Scatterplot of average milk yield and DFC to first cyclicity",
     xlab = "Average milk BHB levels within 60 DFC",
     ylab = "Average milk yield in first 60 DFC (L)", pch = 19)
abline(v = 0.08, col = "red")
abline(lm(Three$AvgMY60~Three$AvgKeto60_atleast10), col = "blue")

cor.test(Three$AvgKeto60_atleast10, Three$AvgMY60, use = "complete.obs", method = "spearman")

par(mfrow = c(2, 2))
plot(df.parity1$AvgKeto60_atleast10, df.parity1$AvgMY60, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto60 (lactation = 1)",
     ylab = "AvgMY60", pch = 19)
abline(lm(df.parity1$AvgMY60~df.parity1$AvgKeto60_atleast10))
abline(v = 0.08, col = "red")

plot(df.parity2$AvgKeto60_atleast10, df.parity2$AvgMY60, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto60 (lactation = 2)",
     ylab = "AvgMY60", pch = 19, col = "red")
abline(lm(df.parity2$AvgMY60~df.parity2$AvgKeto60_atleast10), col = "red")
abline(v = 0.08)

plot(df.parity3$AvgKeto60_atleast10, df.parity3$AvgMY60, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto60 (lactation = 3)",
     ylab = "AvgMY60", pch = 19, col = "green")
abline(lm(df.parity3$AvgMY60~df.parity3$AvgKeto60_atleast10), col = "green")
abline(v = 0.08, col = "red")

plot(df.parity4$AvgKeto60_atleast10, df.parity4$AvgMY60, 
     #main = "Scatterplot of average milk yield and DFC to first cyclicity", 
     xlab = "AvgKeto60 (lactation = 4+)",
     ylab = "AvgMY60", pch = 19, col = "blue")
abline(lm(df.parity4$AvgMY60~df.parity4$AvgKeto60_atleast10), col = "blue")
abline(v = 0.08, col = "red")

## Pearson correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$AvgMY60, use = "complete.obs", method = "pearson")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$AvgMY60, use = "complete.obs", method = "pearson")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$AvgMY60, use = "complete.obs", method = "pearson")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$AvgMY60, use = "complete.obs", method = "pearson")

## Spearman correlation
cor(df.parity1$AvgKeto60_atleast10, df.parity1$AvgMY60, use = "complete.obs", method = "spearman")
cor(df.parity2$AvgKeto60_atleast10, df.parity2$AvgMY60, use = "complete.obs", method = "spearman")
cor(df.parity3$AvgKeto60_atleast10, df.parity3$AvgMY60, use = "complete.obs", method = "spearman")
cor(df.parity4$AvgKeto60_atleast10, df.parity4$AvgMY60, use = "complete.obs", method = "spearman")

## Spearman correlation wtih p-value
cor.test(df.parity1$AvgKeto60_atleast10, df.parity1$AvgMY60, use = "complete.obs", method = "spearman")
cor.test(df.parity2$AvgKeto60_atleast10, df.parity2$AvgMY60, use = "complete.obs", method = "spearman")
cor.test(df.parity3$AvgKeto60_atleast10, df.parity3$AvgMY60, use = "complete.obs", method = "spearman")
cor.test(df.parity4$AvgKeto60_atleast10, df.parity4$AvgMY60, use = "complete.obs", method = "spearman")
```

# Multivariable
## Repro + keto + milk parameters
```{r}
df.repro.keto.milk <- Three %>%
  select(DaysToFirstHeat, DaysToFirstIns, NumAI, AvgKeto20_100, KetoDur20, MaxKetoDIM60, nHighKeto20, PeakMY, PeakDFC, AvgMY20, SumMY20, AvgMY60, SumMY60)
cor.repro.keto.milk <- cor(na.omit(df.repro.keto.milk))
cor.repro.keto.milk
corrplot(cor.repro.keto.milk,
         tl.col = "brown",
         tl.srt = 25, bg = "white",
         title = "\n\n Correlation plot of reproduction, ketosis and milk parameters",
         addCoef.col = "black", number.cex = 0.5,
         type = "lower")
```

# Correlation of milk data
```{r}
milk <- Three %>%
  select(PeakMY, PeakDFC, AvgMY20, SumMY20, AvgMY60, SumMY60)
pairs.panels(milk,
             smooth = TRUE,      # If TRUE, draws loess smooths
             scale = FALSE,      # If TRUE, scales the correlation text font
             density = TRUE,     # If TRUE, adds density plots and histograms
             ellipses = TRUE,    # If TRUE, draws ellipses
             method = "spearman", # Correlation method (also "spearman" or "kendall")
             pch = 21,           # pch symbol
             lm = FALSE,         # If TRUE, plots linear fit rather than the LOESS (smoothed) fit
             cor = TRUE,         # If TRUE, reports correlations
             jiggle = FALSE,     # If TRUE, data points are jittered
             factor = 2,         # Jittering factor
             hist.col = 4,       # Histograms color
             stars = TRUE,       # If TRUE, adds significance level with stars
             ci = TRUE)          # If TRUE, adds confidence intervals
```

# Correlation of ketosis data
```{r}
ketosis <- Three %>%
  select(AvgKeto20_100, KetoDur20, nHighKeto20, MaxKeto20, MaxKetoDIM60)
pairs.panels(ketosis,
             smooth = TRUE,      # If TRUE, draws loess smooths
             scale = FALSE,      # If TRUE, scales the correlation text font
             density = TRUE,     # If TRUE, adds density plots and histograms
             ellipses = TRUE,    # If TRUE, draws ellipses
             method = "spearman", # Correlation method (also "spearman" or "kendall")
             pch = 21,           # pch symbol
             lm = FALSE,         # If TRUE, plots linear fit rather than the LOESS (smoothed) fit
             cor = TRUE,         # If TRUE, reports correlations
             jiggle = FALSE,     # If TRUE, data points are jittered
             factor = 2,         # Jittering factor
             hist.col = 4,       # Histograms color
             stars = TRUE,       # If TRUE, adds significance level with stars
             ci = TRUE)          # If TRUE, adds confidence intervals

corPlot(ketosis, cex = 1.2)
```

# Correlation of reproduction data
```{r}
reproduction <- Three %>%
  select(DaysToFirstHeat, DaysToFirstIns, NumAI, Lactation, cull.calving)
pairs.panels(reproduction,
             smooth = TRUE,      # If TRUE, draws loess smooths
             scale = FALSE,      # If TRUE, scales the correlation text font
             density = TRUE,     # If TRUE, adds density plots and histograms
             ellipses = TRUE,    # If TRUE, draws ellipses
             method = "spearman", # Correlation method (also "spearman" or "kendall")
             pch = 21,           # pch symbol
             lm = FALSE,         # If TRUE, plots linear fit rather than the LOESS (smoothed) fit
             cor = TRUE,         # If TRUE, reports correlations
             jiggle = FALSE,     # If TRUE, data points are jittered
             factor = 2,         # Jittering factor
             hist.col = 4,       # Histograms color
             stars = TRUE,       # If TRUE, adds significance level with stars
             ci = TRUE)          # If TRUE, adds confidence intervals
```

# Correlation of reproduction data
```{r}
reproduction.ketosis <- Three %>%
  select(DaysToFirstHeat, DaysToFirstIns, NumAI, AvgKeto20_100, MaxKetoDIM60, KetoDur20, nHighKeto20, MaxKeto20)
pairs.panels(reproduction.ketosis,
             smooth = TRUE,      # If TRUE, draws loess smooths
             scale = FALSE,      # If TRUE, scales the correlation text font
             density = TRUE,     # If TRUE, adds density plots and histograms
             ellipses = TRUE,    # If TRUE, draws ellipses
             method = "spearman", # Correlation method (also "spearman" or "kendall")
             pch = 21,           # pch symbol
             lm = FALSE,         # If TRUE, plots linear fit rather than the LOESS (smoothed) fit
             cor = TRUE,         # If TRUE, reports correlations
             jiggle = FALSE,     # If TRUE, data points are jittered
             factor = 2,         # Jittering factor
             hist.col = 4,       # Histograms color
             stars = TRUE,       # If TRUE, adds significance level with stars
             ci = TRUE)          # If TRUE, adds confidence intervals

library(psych)
corPlot(reproduction.ketosis, cex = 1,2)
```

