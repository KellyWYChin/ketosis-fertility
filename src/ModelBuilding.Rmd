---
title: "Model building"
author: "Kelly Chin"
date: "3/22/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# R libraries
```{r}
library(readxl)
library(performance)
```

# Linear Model
```{r}
Three <- read_excel("../data/raw/Three.xlsx")
Three$CalvingYear <- as.factor(Three$CalvingYear)

mod1 <- lm(Three$DFCFirstHeat~Three$AvgKeto20_atleast10 + Three$ad_Lactation + Three$PeakDFC + Three$AvgMY60 + Three$CalvingSeason)
summary(mod1)
plot(mod1)

# Log transformation
Three.log <- Three %>%
  mutate(log.DFC_CLA = log(DFC_CLA),
         log.DFCFirstHeat = log(DFCFirstHeat), 
         log.DaysToFirstIns = log(DaysToFirstIns), 
         log.AvgKeto20 = log(AvgKeto20_atleast10), 
         log.AvgKeto60 = log(AvgKeto60_atleast10)) #4327 obs of 71v
         

mod1.log <- lm(Three.log$log.DFCFirstHeat~Three.log$AvgKeto20_atleast20 + Three.log$ad_Lactation + Three.log$PeakDFC + Three.log$AvgMY60 + Three.log$CalvingSeason)
summary(mod1.log)
plot(mod1.log)

mod2.log <- lm(Three.log$log.DFCFirstHeat~Three.log$log.AvgKeto20 + Three.log$ad_Lactation + Three.log$PeakDFC + Three.log$AvgMY60 + Three.log$CalvingSeason)
summary(mod2.log)
plot(mod2.log)

anova(mod1.log, mod2.log)
compare_performance(mod1.log, mod2.log, rank = TRUE)
```

